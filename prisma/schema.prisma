generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                            String         @id @default(cuid())
  email                         String         @unique
  emailVerified                 DateTime?
  password                      String?
  name                          String?
  image                         String?
  role                          String         @default("CUSTOMER")
  language                      String         @default("en")
  billingAddress                String?
  createdAt                     DateTime       @default(now())
  updatedAt                     DateTime       @updatedAt
  emailVerificationToken        String?
  emailVerificationTokenExpires DateTime?
  pendingEmail                  String?
  pendingName                   String?
  notes                         String?
  resetPasswordExpires          DateTime?
  resetPasswordToken            String?
  deleteAccountToken            String?
  deleteAccountTokenExpires     DateTime?
  accounts                      Account[]
  comments                      Comment[]
  notifications                 Notification[] @relation("UserNotifications")
  orders                        Order[]        @relation("CustomerOrders")
  sessions                      Session[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Order {
  id                 String      @id @default(cuid())
  title              String?
  description        String?
  status             String      @default("WAITING_PRICE")
  price              Float?
  hidden             Boolean     @default(false)
  machineBrand       String?
  serviceType        String?
  productType        String?
  garmentType        String?
  isNotSure          Boolean     @default(false)
  customProduct      String?
  addKnockdownStitch Boolean     @default(false)
  customerId         String
  priority           String      @default("NORMAL")
  estimatedDelivery  DateTime?
  cancelledAt        DateTime?
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt
  comments           Comment[]
  files              File[]
  customer           User        @relation("CustomerOrders", fields: [customerId], references: [id], onDelete: Cascade)
  wilcomData         WilcomData?

  @@index([customerId])
  @@index([status])
  @@index([createdAt])
  @@index([priority])
}

model WilcomData {
  id                  String    @id @default(cuid())
  orderId             String    @unique
  designName          String
  title               String?
  heightMm            Float
  widthMm             Float
  stitchCount         Int
  colorCount          Int
  colorway            String?
  machineFormat       String?
  machineRuntime      String?
  colorChanges        Int?
  stops               Int?
  trims               Int?
  maxStitchMm         Float?
  minStitchMm         Float?
  maxJumpMm           Float?
  totalThreadM        Float?
  totalBobbinM        Float?
  leftMm              Float?
  rightMm             Float?
  upMm                Float?
  downMm              Float?
  areaMm2             Float?
  colors              String
  colorSequence       String
  designImageUrl      String?
  customerArtworkUrl  String?
  operatorApprovalPdf String?
  customerApprovalPdf String?
  wilcomPdfUrl        String?
  designLastSaved     DateTime?
  datePrinted         DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  order               Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model File {
  id            String   @id @default(cuid())
  name          String
  url           String
  type          String
  size          Int?
  version       Int      @default(1)
  replacesFileId String?
  orderId       String
  commentId     String?
  uploadedBy    String
  createdAt     DateTime @default(now())
  comment       Comment? @relation(fields: [commentId], references: [id])
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([type])
  @@index([uploadedBy])
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  orderId   String
  userId    String
  isSystem  Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  files     File[]

  @@index([orderId])
  @@index([userId])
  @@index([createdAt])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String
  message   String
  type      String
  link      String?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([createdAt])
}
