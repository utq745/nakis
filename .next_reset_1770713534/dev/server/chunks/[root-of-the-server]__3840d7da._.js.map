{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/utkusakallioglu/Documents/nakis/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient();\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/utkusakallioglu/Documents/nakis/src/lib/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport Credentials from \"next-auth/providers/credentials\";\nimport Google from \"next-auth/providers/google\";\nimport Apple from \"next-auth/providers/apple\";\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\nimport { compare } from \"bcryptjs\";\nimport prisma from \"@/lib/prisma\";\nimport type { Role } from \"@/types\";\n\ndeclare module \"next-auth\" {\n    interface Session {\n        user: {\n            id: string;\n            email: string;\n            name?: string | null;\n            image?: string | null;\n            role: Role;\n        };\n    }\n\n    interface User {\n        id: string;\n        email: string;\n        name?: string | null;\n        image?: string | null;\n        role: Role;\n    }\n}\n\ndeclare module \"@auth/core/jwt\" {\n    interface JWT {\n        id: string;\n        role: Role;\n        image?: string | null;\n        sessionVersion?: number;\n        invalidated?: boolean;\n    }\n}\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n    adapter: PrismaAdapter(prisma) as any,\n    trustHost: process.env.AUTH_TRUST_HOST === 'true',\n    providers: [\n        Google({\n            clientId: process.env.GOOGLE_CLIENT_ID,\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n            allowDangerousEmailAccountLinking: true,\n        }),\n        Credentials({\n            name: \"credentials\",\n            credentials: {\n                email: { label: \"Email\", type: \"email\" },\n                password: { label: \"Password\", type: \"password\" },\n            },\n            async authorize(credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    return null;\n                }\n\n                const user = await prisma.user.findUnique({\n                    where: {\n                        email: credentials.email as string,\n                    },\n                });\n\n                if (!user || user.password === null) {\n                    return null;\n                }\n\n                const isPasswordValid = await compare(\n                    credentials.password as string,\n                    user.password\n                );\n\n                if (!isPasswordValid) {\n                    return null;\n                }\n\n                return {\n                    id: user.id,\n                    email: user.email,\n                    name: user.name,\n                    image: user.image,\n                    role: user.role as Role,\n                };\n            },\n        }),\n    ],\n    callbacks: {\n        async jwt({ token, user, trigger, session }) {\n            const userId = (user?.id || token.id) as string | undefined;\n\n            if (userId) {\n                const dbUser = await prisma.user.findUnique({\n                    where: { id: userId },\n                    select: { sessionVersion: true },\n                });\n\n                if (!dbUser) {\n                    token.invalidated = true;\n                    token.exp = Math.floor(Date.now() / 1000) - 10;\n                    return token;\n                }\n\n                if (user) {\n                    token.sessionVersion = dbUser.sessionVersion;\n                    token.invalidated = false;\n                } else {\n                    const tokenSessionVersion = typeof token.sessionVersion === \"number\" ? token.sessionVersion : 0;\n                    if (tokenSessionVersion !== dbUser.sessionVersion) {\n                        token.invalidated = true;\n                        token.exp = Math.floor(Date.now() / 1000) - 10;\n                        return token;\n                    }\n                }\n            }\n\n            if (user) {\n                token.id = user.id;\n                token.role = (user as any).role || \"CUSTOMER\";\n                token.image = user.image;\n            }\n            if (trigger === \"update\" && session) {\n                if (session.role) token.role = session.role;\n                if (session.image !== undefined) token.image = session.image;\n                if (session.name !== undefined) token.name = session.name;\n            }\n            return token;\n        },\n        async session({ session, token }) {\n            if (token.invalidated) {\n                return { ...session, expires: new Date(0).toISOString() };\n            }\n\n            if (token && session.user) {\n                session.user.id = token.id as string;\n                session.user.role = token.role as Role;\n                session.user.image = token.image as string | null;\n                if (token.name) session.user.name = token.name as string;\n            }\n            return session;\n        },\n    },\n    events: {\n        async createUser({ user }) {\n            // New OAuth users: sync profile data and set CUSTOMER role\n            if (user.id) {\n                await prisma.user.update({\n                    where: { id: user.id },\n                    data: {\n                        role: \"CUSTOMER\",\n                        // Sync name and email from OAuth profile\n                        ...(user.name && { name: user.name }),\n                        ...(user.email && { email: user.email }),\n                        ...(user.image && { image: user.image }),\n                    }\n                });\n            }\n        }\n    },\n    pages: {\n        signIn: \"/login\",\n    },\n    session: {\n        strategy: \"jwt\",\n    },\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///Users/utkusakallioglu/Documents/nakis/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import { handlers } from \"@/lib/auth\";\n\nexport const { GET, POST } = handlers;\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,sJAAQ"}}]
}