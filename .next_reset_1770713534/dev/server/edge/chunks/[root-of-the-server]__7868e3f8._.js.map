{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Documents/nakis/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nconst locales = ['en', 'tr'];\nconst defaultLocale = 'en';\n\n// Get locale from pathname\nfunction getLocale(pathname: string): string | undefined {\n    // Check for /tr prefix\n    if (pathname.startsWith('/tr/') || pathname === '/tr') {\n        return 'tr';\n    }\n    // Everything else is English (default)\n    return 'en';\n}\n\n// Allowed origins for CSRF protection\nconst allowedOrigins = [\n    process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000',\n    'http://localhost:3000',\n];\n\nexport function middleware(request: NextRequest) {\n    const pathname = request.nextUrl.pathname;\n    const response = NextResponse.next();\n\n    // Add security headers to all responses\n    response.headers.set('X-Content-Type-Options', 'nosniff');\n    response.headers.set('X-Frame-Options', 'DENY');\n    response.headers.set('X-XSS-Protection', '1; mode=block');\n    response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n    // HSTS - Strict Transport Security (1 year, include subdomains)\n    response.headers.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');\n\n    // HTTPS enforcement is handled by Cloudflare proxy\n    /*\n    const isProduction = process.env.NODE_ENV === 'production';\n    const proto = request.headers.get('x-forwarded-proto');\n    if (isProduction && proto === 'http') {\n        const httpsUrl = request.url.replace('http://', 'https://');\n        return NextResponse.redirect(httpsUrl, 301);\n    }\n    */\n\n    // CSRF protection for API routes (POST, PUT, PATCH, DELETE)\n    if (pathname.startsWith('/api/')) {\n        // Skip manual CSRF check for Auth.js routes as it has its own CSRF protection\n        if (pathname.startsWith('/api/auth/')) {\n            return response;\n        }\n\n        const method = request.method;\n\n        if (['POST', 'PUT', 'PATCH', 'DELETE'].includes(method)) {\n            const origin = request.headers.get('origin');\n            const referer = request.headers.get('referer');\n\n            // Check origin or referer for state-changing requests\n            if (origin) {\n                const isAllowed = allowedOrigins.some(allowed =>\n                    origin === allowed || origin.startsWith(allowed)\n                );\n                if (!isAllowed) {\n                    return NextResponse.json(\n                        { error: 'Forbidden - Invalid origin' },\n                        { status: 403 }\n                    );\n                }\n            } else if (referer) {\n                const isAllowed = allowedOrigins.some(allowed =>\n                    referer.startsWith(allowed)\n                );\n                if (!isAllowed) {\n                    return NextResponse.json(\n                        { error: 'Forbidden - Invalid referer' },\n                        { status: 403 }\n                    );\n                }\n            } else {\n                // If no origin OR referer, reject for security (prevent CSRF bypass)\n                return NextResponse.json(\n                    { error: 'Forbidden - Missing Origin or Referer' },\n                    { status: 403 }\n                );\n            }\n\n        }\n\n        return response;\n    }\n\n    // Skip static files\n    if (\n        pathname.startsWith('/_next/') ||\n        pathname.startsWith('/favicon.ico') ||\n        pathname.includes('.')\n    ) {\n        return response;\n    }\n\n    // If path starts with /tr, let it through\n    if (pathname.startsWith('/tr')) {\n        return response;\n    }\n\n    // For all other paths, they're English (no redirect needed)\n    return response;\n}\n\nexport const config = {\n    matcher: [\n        // Match all paths except static files\n        '/((?!_next/static|_next/image|favicon.ico|.*\\\\..*).*)',\n    ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGA,MAAM,UAAU;IAAC;IAAM;CAAK;AAC5B,MAAM,gBAAgB;AAEtB,2BAA2B;AAC3B,SAAS,UAAU,QAAgB;IAC/B,uBAAuB;IACvB,IAAI,SAAS,UAAU,CAAC,WAAW,aAAa,OAAO;QACnD,OAAO;IACX;IACA,uCAAuC;IACvC,OAAO;AACX;AAEA,sCAAsC;AACtC,MAAM,iBAAiB;IACnB,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IACnC;CACH;AAEM,SAAS,WAAW,OAAoB;IAC3C,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IACzC,MAAM,WAAW,sNAAY,CAAC,IAAI;IAElC,wCAAwC;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,oBAAoB;IACzC,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,gEAAgE;IAChE,SAAS,OAAO,CAAC,GAAG,CAAC,6BAA6B;IAElD,mDAAmD;IACnD;;;;;;;IAOA,GAEA,4DAA4D;IAC5D,IAAI,SAAS,UAAU,CAAC,UAAU;QAC9B,8EAA8E;QAC9E,IAAI,SAAS,UAAU,CAAC,eAAe;YACnC,OAAO;QACX;QAEA,MAAM,SAAS,QAAQ,MAAM;QAE7B,IAAI;YAAC;YAAQ;YAAO;YAAS;SAAS,CAAC,QAAQ,CAAC,SAAS;YACrD,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;YACnC,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC;YAEpC,sDAAsD;YACtD,IAAI,QAAQ;gBACR,MAAM,YAAY,eAAe,IAAI,CAAC,CAAA,UAClC,WAAW,WAAW,OAAO,UAAU,CAAC;gBAE5C,IAAI,CAAC,WAAW;oBACZ,OAAO,sNAAY,CAAC,IAAI,CACpB;wBAAE,OAAO;oBAA6B,GACtC;wBAAE,QAAQ;oBAAI;gBAEtB;YACJ,OAAO,IAAI,SAAS;gBAChB,MAAM,YAAY,eAAe,IAAI,CAAC,CAAA,UAClC,QAAQ,UAAU,CAAC;gBAEvB,IAAI,CAAC,WAAW;oBACZ,OAAO,sNAAY,CAAC,IAAI,CACpB;wBAAE,OAAO;oBAA8B,GACvC;wBAAE,QAAQ;oBAAI;gBAEtB;YACJ,OAAO;gBACH,qEAAqE;gBACrE,OAAO,sNAAY,CAAC,IAAI,CACpB;oBAAE,OAAO;gBAAwC,GACjD;oBAAE,QAAQ;gBAAI;YAEtB;QAEJ;QAEA,OAAO;IACX;IAEA,oBAAoB;IACpB,IACI,SAAS,UAAU,CAAC,cACpB,SAAS,UAAU,CAAC,mBACpB,SAAS,QAAQ,CAAC,MACpB;QACE,OAAO;IACX;IAEA,0CAA0C;IAC1C,IAAI,SAAS,UAAU,CAAC,QAAQ;QAC5B,OAAO;IACX;IAEA,4DAA4D;IAC5D,OAAO;AACX;AAEO,MAAM,SAAS;IAClB,SAAS;QACL,sCAAsC;QACtC;KACH;AACL"}}]
}